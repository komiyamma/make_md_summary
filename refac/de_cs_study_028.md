# ç¬¬28ç«  ãƒ†ã‚¹ãƒˆâ‘¡ï¼šãƒãƒ³ãƒ‰ãƒ©å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆå¤–éƒ¨I/Oã¯å·®ã—æ›¿ãˆï¼‰ğŸ­ğŸ§ª

## ã“ã®ç« ã®ã‚´ãƒ¼ãƒ«ğŸ¯âœ¨

* ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã®**ãƒãƒ³ãƒ‰ãƒ©ã ã‘**ã‚’ã€ã‚µã‚¯ãƒƒã¨é€Ÿããƒ†ã‚¹ãƒˆã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ğŸƒâ€â™€ï¸ğŸ’¨
* ãƒ¡ãƒ¼ãƒ«é€ä¿¡ğŸ“§ãƒ»HTTPå‘¼ã³å‡ºã—ğŸŒãƒ»DBæ›¸ãè¾¼ã¿ğŸ’¾ã¿ãŸã„ãª**å¤–éƒ¨I/Oã‚’ãƒ†ã‚¹ãƒˆã‹ã‚‰è¿½ã„å‡ºã™**ã‚„ã‚Šæ–¹ãŒã‚ã‹ã‚‹ğŸ™…â€â™€ï¸â¡ï¸ğŸ§©
* ã€Œå‘¼ã°ã‚ŒãŸï¼Ÿã€ã€Œæ­£ã—ã„å†…å®¹ã§å‘¼ã°ã‚ŒãŸï¼Ÿã€ã‚’**ãƒ¢ãƒƒã‚¯/ãƒ•ã‚§ã‚¤ã‚¯**ã§ç¢ºèªã§ãã‚‹âœ…
* å¤±æ•—æ™‚ï¼ˆä¾‹å¤–ğŸ’¥ï¼‰ã®ãµã‚‹ã¾ã„ã‚‚ã€æ–¹é‡ã©ãŠã‚Šã«ãƒ†ã‚¹ãƒˆã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ğŸ§¯ğŸ”

---

## ã¾ãšè¶…å¤§äº‹ï¼šãƒãƒ³ãƒ‰ãƒ©ã®å˜ä½“ãƒ†ã‚¹ãƒˆã£ã¦ä½•ã™ã‚‹ã®ï¼ŸğŸ¤”ğŸ§ª

ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒãƒ³ãƒ‰ãƒ©ã¯ã€ã ã„ãŸã„ã“ã†ã„ã†â€œä»˜éšå‡¦ç†â€ã‚’æ‹…å½“ã—ã¾ã™ğŸ‘‡

* ãƒ¡ãƒ¼ãƒ«é€ã‚‹ğŸ“§
* Slacké€šçŸ¥ã™ã‚‹ğŸ’¬
* ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ã™ã‚‹ğŸ
* å¤–éƒ¨APIå©ãğŸŒ
* ãƒ­ã‚°å‡ºã™ğŸ§¾

ã§ã‚‚ã“ã‚Œã‚‰ã¯**å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹**ã«ä¾å­˜ã—ãŒã¡ã€‚
ãã®ã¾ã¾ãƒ†ã‚¹ãƒˆã™ã‚‹ã¨â€¦

* ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¬¡ç¬¬ã§è½ã¡ã‚‹ğŸŒ§ï¸
* ãƒ¡ãƒ¼ãƒ«å®Ÿé€ä¿¡ã—ã¡ã‚ƒã†ğŸ˜±
* ãƒ†ã‚¹ãƒˆãŒé…ã„ğŸ¢
* â€œãŸã¾ã«è½ã¡ã‚‹â€æœ€æ‚ªã®çŠ¶æ…‹ã«ãªã‚‹ğŸ’”

ã ã‹ã‚‰**ãƒãƒ³ãƒ‰ãƒ©å˜ä½“ãƒ†ã‚¹ãƒˆ**ã§ã¯ã“ã†ã—ã¾ã™ğŸ‘‡

âœ… **å¤–éƒ¨I/Oã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®â€œå·®ã—æ›¿ãˆâ€ã«ã™ã‚‹**
âœ… ãƒ†ã‚¹ãƒˆã§ã¯â€œå½ç‰©ï¼ˆãƒ¢ãƒƒã‚¯/ãƒ•ã‚§ã‚¤ã‚¯ï¼‰â€ã‚’æ¸¡ã—ã¦ã€**å‘¼ã³å‡ºã—ã ã‘æ¤œè¨¼**ã™ã‚‹

---

## 2026æ™‚ç‚¹ã®ãƒ†ã‚¹ãƒˆç’°å¢ƒï¼ˆæƒ…å ±ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼‰ğŸ†•ğŸ§ 

* .NET 10 ã¯ LTSï¼ˆé•·æœŸã‚µãƒãƒ¼ãƒˆï¼‰ã§ã€2025/11/11 ã«ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã„ã¾ã™ğŸ“…âœ¨ ([Microsoft for Developers][1])
* xUnit ã¯ v3 ç³»ãŒé€²ã‚“ã§ã„ã¦ã€æœ€æ–°ãƒªãƒªãƒ¼ã‚¹ä¸€è¦§ã§ã¯ **xunit.v3 3.2.2** ãŒæ²è¼‰ã•ã‚Œã¦ã„ã¾ã™ğŸ§ª ([xUnit.net][2])

  * v3 ã¯ **.NET 8+ ã‚’ã‚µãƒãƒ¼ãƒˆ**ï¼ˆã¤ã¾ã‚Šä»Šã©ãã® .NET ãªã‚‰OKï¼‰ã§ã™ğŸ‘ ([xUnit.net][3])
  * Visual Studio ç”¨ã‚¢ãƒ€ãƒ—ã‚¿ã‚‚æä¾›ã•ã‚Œã¦ã„ã¾ã™ï¼ˆä¾‹ï¼šxunit.runner.visualstudioï¼‰ğŸ§© ([NuGet][4])
* ãƒ¢ãƒƒã‚¯ï¼ˆå½ç‰©ã‚’ä½œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ã¨ã—ã¦ Moq ã¯ä»Šã‚‚å®šç•ªã§ã€NuGet ã§ã¯ **4.20.72** ãŒç¢ºèªã§ãã¾ã™ğŸ­ ([NuGet][5])

ã“ã®ç« ã¯ã€**xUnit + Moq**ã§ã„ãã¾ã™ğŸ’ªâœ¨ï¼ˆä»–ã§ã‚‚è€ƒãˆæ–¹ã¯åŒã˜ã ã‚ˆğŸ™‚ï¼‰

---

## ãƒ¢ãƒƒã‚¯ã¨ãƒ•ã‚§ã‚¤ã‚¯ã€ã©ã†ä½¿ã„åˆ†ã‘ã‚‹ï¼ŸğŸ­ğŸ§¸

ã–ã£ãã‚Šã§OKï¼è¦šãˆæ–¹ã¯ã“ã‚ŒğŸ‘‡

* **ãƒ¢ãƒƒã‚¯ï¼ˆMockï¼‰**ğŸ­ï¼š
  ã€Œã“ã®ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã°ã‚ŒãŸï¼Ÿä½•å›ï¼Ÿã©ã‚“ãªå¼•æ•°ï¼Ÿã€ã‚’æ¤œè¨¼ã—ãŸã„ã¨ãã«å¼·ã„âœ…
* **ãƒ•ã‚§ã‚¤ã‚¯ï¼ˆFakeï¼‰**ğŸ§¸ï¼š
  â€œãƒ†ã‚¹ãƒˆå°‚ç”¨ã®ç°¡å˜ãªå®Ÿè£…â€ã‚’ä½œã£ã¦ã€å‘¼ã°ã‚ŒãŸå†…å®¹ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãâœ…

æœ€åˆã¯ **ã©ã£ã¡ã§ã‚‚OK**ã€‚
ãŸã ã€åˆå¿ƒè€…ã•ã‚“ã¯ãƒ•ã‚§ã‚¤ã‚¯ã®ã»ã†ãŒã€Œä½•ãŒèµ·ãã¦ã‚‹ã‹ã€è¦‹ãˆã‚„ã™ã„ã“ã¨ãŒå¤šã„ã‚ˆğŸ‘€âœ¨

---

## ä¾‹é¡Œï¼šæ”¯æ‰•ã„å®Œäº†ï¼ˆOrderPaidï¼‰ã§ãƒ¡ãƒ¼ãƒ«ã‚’é€ã‚‹ğŸ“§ğŸ””

### ç™»å ´äººç‰©ï¼ˆæœ€å°ã‚»ãƒƒãƒˆï¼‰ğŸ§©

* ã‚¤ãƒ™ãƒ³ãƒˆï¼š`OrderPaid`
* ãƒãƒ³ãƒ‰ãƒ©ï¼š`SendReceiptEmailHandler`
* å¤–éƒ¨I/Oï¼š`IEmailSender`ï¼ˆSMTPã‚„å¤–éƒ¨ãƒ¡ãƒ¼ãƒ«APIã®ã¤ã‚‚ã‚Šï¼‰

---

## å®Ÿè£…ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒ»ãƒãƒ³ãƒ‰ãƒ©ï¼‰ğŸ§©ğŸ› ï¸

```csharp
using System;
using System.Threading;
using System.Threading.Tasks;

public sealed record OrderPaid(
    Guid OrderId,
    string CustomerEmail,
    DateTimeOffset OccurredAtUtc
);

public interface IEmailSender
{
    Task SendAsync(string to, string subject, string body, CancellationToken ct);
}

public sealed class SendReceiptEmailHandler
{
    private readonly IEmailSender _emailSender;

    public SendReceiptEmailHandler(IEmailSender emailSender)
        => _emailSender = emailSender;

    public async Task HandleAsync(OrderPaid ev, CancellationToken ct = default)
    {
        // ã“ã“ã§ã¯ã€Œãƒ¡ãƒ¼ãƒ«æ–‡é¢ã¥ãã‚Šã€ã¯è¶…ç°¡ç•¥åŒ–ğŸ™‚
        var subject = $"Receipt for Order {ev.OrderId}";
        var body = $"Thank you! Paid at {ev.OccurredAtUtc:O}";

        await _emailSender.SendAsync(ev.CustomerEmail, subject, body, ct);
    }
}
```

ãƒã‚¤ãƒ³ãƒˆğŸŒŸ

* ãƒãƒ³ãƒ‰ãƒ©ã¯ã€Œãƒ¡ãƒ¼ãƒ«ã‚’é€ã‚‹ã€ã¨ã„ã†**ã‚„ã‚ŠãŸã„ã“ã¨**ã ã‘æŒã¤ğŸ¯
* SMTPã¨ã‹HTTPã¨ã‹ã€å¤–ã®ä¸–ç•Œã¯ `IEmailSender` ã«æŠ¼ã—è¾¼ã‚ã‚‹ğŸ“¦

---

## ãƒ†ã‚¹ãƒˆâ‘ ï¼šMoqã§ã€Œå‘¼ã°ã‚ŒãŸã“ã¨ã€ã‚’æ¤œè¨¼ã™ã‚‹âœ…ğŸ­

```csharp
using System;
using System.Threading;
using System.Threading.Tasks;
using Moq;
using Xunit;

public class SendReceiptEmailHandlerTests
{
    [Fact]
    public async Task HandleAsync_SendsEmail_WithExpectedToAndSubject()
    {
        // Arrange ğŸ§©
        var emailSenderMock = new Mock<IEmailSender>();

        var handler = new SendReceiptEmailHandler(emailSenderMock.Object);

        var ev = new OrderPaid(
            OrderId: Guid.Parse("aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee"),
            CustomerEmail: "alice@example.com",
            OccurredAtUtc: DateTimeOffset.Parse("2026-01-01T12:00:00+00:00")
        );

        // Act ğŸƒâ€â™€ï¸
        await handler.HandleAsync(ev, CancellationToken.None);

        // Assert âœ…
        emailSenderMock.Verify(x =>
            x.SendAsync(
                "alice@example.com",
                "Receipt for Order aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee",
                It.Is<string>(body => body.Contains("Paid at")),
                It.IsAny<CancellationToken>()
            ),
            Times.Once
        );
    }
}
```

### ã“ã“ã§å­¦ã¶ã“ã¨ğŸ“š

* **å¤–éƒ¨I/Oã¯å®Ÿè¡Œã—ãªã„**ï¼ˆæœ¬ç‰©ãƒ¡ãƒ¼ãƒ«ã¯é£›ã°ãªã„ğŸ“§âŒï¼‰
* ä»£ã‚ã‚Šã«ã€Œé€ä¿¡ãƒ¡ã‚½ãƒƒãƒ‰ãŒã€æœŸå¾…ã©ãŠã‚Šå‘¼ã°ã‚ŒãŸã‹ã€ã‚’è¦‹ã‚‹âœ…

---

## ãƒ†ã‚¹ãƒˆâ‘¡ï¼šãƒ•ã‚§ã‚¤ã‚¯ã§ã€Œé€ã£ãŸå†…å®¹ã€ã‚’ã¾ã‚‹ã£ã¨è¦‹ã‚‹ğŸ§¸ğŸ‘€

ãƒ¢ãƒƒã‚¯ãŒã¡ã‚‡ã„é›£ã—ãæ„Ÿã˜ãŸã‚‰ã€ãƒ•ã‚§ã‚¤ã‚¯ã§ã‚‚ãœã‚“ãœã‚“OKï¼

```csharp
using System.Collections.Generic;
using System.Threading;
using System.Threading.Tasks;

public sealed class FakeEmailSender : IEmailSender
{
    public sealed record SentMail(string To, string Subject, string Body);

    private readonly List<SentMail> _sent = new();
    public IReadOnlyList<SentMail> Sent => _sent;

    public Task SendAsync(string to, string subject, string body, CancellationToken ct)
    {
        _sent.Add(new SentMail(to, subject, body));
        return Task.CompletedTask;
    }
}
```

```csharp
using System;
using System.Threading.Tasks;
using Xunit;

public class SendReceiptEmailHandler_FakeTests
{
    [Fact]
    public async Task HandleAsync_AddsOneMail_ToFakeSender()
    {
        // Arrange ğŸ§©
        var fake = new FakeEmailSender();
        var handler = new SendReceiptEmailHandler(fake);

        var ev = new OrderPaid(
            Guid.NewGuid(),
            "alice@example.com",
            DateTimeOffset.UtcNow
        );

        // Act ğŸƒâ€â™€ï¸
        await handler.HandleAsync(ev);

        // Assert âœ…
        Assert.Single(fake.Sent);
        Assert.Equal("alice@example.com", fake.Sent[0].To);
        Assert.Contains("Receipt for Order", fake.Sent[0].Subject);
    }
}
```

ãƒ•ã‚§ã‚¤ã‚¯ã®è‰¯ã•âœ¨

* ä½•ãŒé€ã‚‰ã‚ŒãŸã‹ã€**é…åˆ—ã§è¦‹ãˆã‚‹**ğŸ‘€
* åˆå­¦è€…ã«ã‚„ã•ã—ã„ğŸ™‚ğŸ€

---

## å¤±æ•—æ™‚ã®ãƒ†ã‚¹ãƒˆï¼šä¾‹å¤–ã‚’â€œã©ã†æ‰±ã†ã‹â€ã‚’æ±ºã‚ã‚‹ğŸ’¥ğŸ§¯

ã“ã“ã€è¶…å¤§äº‹ãƒã‚¤ãƒ³ãƒˆï¼
ã€Œãƒ¡ãƒ¼ãƒ«é€ä¿¡ãŒå¤±æ•—ã—ãŸã‚‰ã€æ³¨æ–‡ç¢ºå®šï¼ˆä¸»å‡¦ç†ï¼‰ã¾ã§å¤±æ•—ã«ã™ã‚‹ï¼Ÿã€å•é¡ŒãŒã‚ã‚‹ã‚ˆã­ğŸ˜µâ€ğŸ’«

ã“ã®ç« ã¯**ãƒãƒ³ãƒ‰ãƒ©å˜ä½“ãƒ†ã‚¹ãƒˆ**ãªã®ã§ã€æ–¹é‡ã¯2ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ç´¹ä»‹ã™ã‚‹ã­ğŸ‘‡
ï¼ˆã©ã£ã¡ãŒæ­£ã—ã„ã‹ã¯æ¥­å‹™æ¬¡ç¬¬ğŸ™‚ï¼‰

---

### ãƒ‘ã‚¿ãƒ¼ãƒ³Aï¼šå¤±æ•—ã—ãŸã‚‰ä¾‹å¤–ã‚’ãã®ã¾ã¾æŠ•ã’ã‚‹ï¼ˆå‘¼ã³å‡ºã—å…ƒã§åˆ¤æ–­ï¼‰ğŸ’¥

ã“ã®å ´åˆã¯ã€Œä¾‹å¤–ãŒèµ·ãã‚‹ã“ã¨ã€ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹âœ…

```csharp
using System;
using System.Threading;
using System.Threading.Tasks;
using Moq;
using Xunit;

public class SendReceiptEmailHandler_FailureTests
{
    [Fact]
    public async Task HandleAsync_WhenEmailSenderThrows_PropagatesException()
    {
        // Arrange
        var mock = new Mock<IEmailSender>();
        mock.Setup(x => x.SendAsync(
                It.IsAny<string>(),
                It.IsAny<string>(),
                It.IsAny<string>(),
                It.IsAny<CancellationToken>()))
            .ThrowsAsync(new InvalidOperationException("SMTP down"));

        var handler = new SendReceiptEmailHandler(mock.Object);

        var ev = new OrderPaid(Guid.NewGuid(), "alice@example.com", DateTimeOffset.UtcNow);

        // Act & Assert
        await Assert.ThrowsAsync<InvalidOperationException>(() => handler.HandleAsync(ev));
    }
}
```

---

### ãƒ‘ã‚¿ãƒ¼ãƒ³Bï¼šå¤±æ•—ã¯é£²ã¿è¾¼ã‚“ã§ãƒ­ã‚°ã ã‘å‡ºã™ï¼ˆä¸»å‡¦ç†ã‚’å®ˆã‚‹ï¼‰ğŸ§¾ğŸ™‚

ã“ã®å ´åˆã¯ã€ãƒãƒ³ãƒ‰ãƒ©å´ã‚’ã“ã†å¤‰ãˆã‚‹ğŸ‘‡ï¼ˆä¾‹å¤–ã‚’æ¡ã‚Šã¤ã¶ã™ä»£ã‚ã‚Šã«ãƒ­ã‚°ï¼‰

```csharp
using Microsoft.Extensions.Logging;

public sealed class SendReceiptEmailHandler_WithLogging
{
    private readonly IEmailSender _emailSender;
    private readonly ILogger<SendReceiptEmailHandler_WithLogging> _logger;

    public SendReceiptEmailHandler_WithLogging(
        IEmailSender emailSender,
        ILogger<SendReceiptEmailHandler_WithLogging> logger)
    {
        _emailSender = emailSender;
        _logger = logger;
    }

    public async Task HandleAsync(OrderPaid ev, CancellationToken ct = default)
    {
        try
        {
            var subject = $"Receipt for Order {ev.OrderId}";
            var body = $"Thank you! Paid at {ev.OccurredAtUtc:O}";
            await _emailSender.SendAsync(ev.CustomerEmail, subject, body, ct);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Failed to send receipt email. OrderId={OrderId}", ev.OrderId);
            // é£²ã¿è¾¼ã‚€ï¼ˆæ–¹é‡ï¼ï¼‰
        }
    }
}
```

#### ãƒ­ã‚°ã®ãƒ†ã‚¹ãƒˆã¯ã€ŒFakeLoggerã€ã‚’ä½¿ã†ã¨ãƒ©ã‚¯ğŸ§ªğŸ§¾

`FakeLogger` ã¯ãƒ†ã‚¹ãƒˆå‘ã‘ã«ãƒ­ã‚°ã‚’ãƒ¡ãƒ¢ãƒªã«è²¯ã‚ã¦æ¤œè¨¼ã§ãã‚‹ä»•çµ„ã¿ã§ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚ã€Œãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆç”¨ã€ã¨èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ğŸ§ âœ¨ ([Microsoft Learn][6])
ï¼ˆé–¢é€£ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦ `Microsoft.Extensions.Diagnostics.Testing` ãŒä½¿ã‚ã‚Œã¾ã™ï¼‰ ([NuGet][7])

â€»ã“ã“ã¯ã€Œãƒ­ã‚°ã¾ã§ãƒ†ã‚¹ãƒˆã—ãŸã„äººå‘ã‘ã€ã®ç™ºå±•ğŸ’¡ï¼ˆå¿…é ˆã˜ã‚ƒãªã„ã‚ˆğŸ™‚ï¼‰

---

## ãƒãƒ³ãƒ‰ãƒ©å˜ä½“ãƒ†ã‚¹ãƒˆã®â€œå‹ã¡ãƒ‘ã‚¿ãƒ¼ãƒ³â€ã¾ã¨ã‚ğŸ†âœ¨

### âœ… 1. ãƒ†ã‚¹ãƒˆå¯¾è±¡ã¯ã€Œãƒãƒ³ãƒ‰ãƒ©1å€‹ã ã‘ã€

* Dispatcher ã‚„ DI ã‚³ãƒ³ãƒ†ãƒŠã¯æŒã¡è¾¼ã¾ãªã„ğŸ™…â€â™€ï¸
* **new ã—ã¦å‘¼ã¶ã ã‘**ãŒæœ€å¼·ã«å®‰å®šã™ã‚‹ğŸ’ª

### âœ… 2. å¤–éƒ¨I/Oã¯ã€Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹1æšã€ã§éš”é›¢

* `IEmailSender` / `ISlackClient` / `IHttpClient`ï¼ˆè–„ã„è‡ªä½œï¼‰ã¿ãŸã„ã«åˆ†ã‘ã‚‹ğŸ§©
* â€œè©³ç´°â€ã‚’å¥¥ã«æŠ¼ã—è¾¼ã‚€ğŸ“¦

### âœ… 3. Assertã¯ã€Œé‡è¦ãªã“ã¨ã ã‘ã€

* ä»¶æ•°ï¼ˆ1å›ã ã‘é€ã£ãŸï¼Ÿï¼‰âœ…
* å®›å…ˆ/ä»¶åï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³çš„ã«é‡è¦ï¼Ÿï¼‰âœ…
* æœ¬æ–‡ã®å…¨éƒ¨ä¸€è‡´ã¯ã€å£Šã‚Œã‚„ã™ã„ã‹ã‚‰ã»ã©ã»ã©ã«ğŸ™‚

---

## ã‚ˆãã‚ã‚‹ã¤ã¾ãšãé›†ğŸ˜µâ€ğŸ’«ğŸ§¯

### âŒ `async` ã‚’ `await` ã—ã¦ãªãã¦ãƒ†ã‚¹ãƒˆãŒã™ã‚ŠæŠœã‘ã‚‹

â†’ ãƒ†ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã‚‚ `async Task` ã«ã—ã¦ã€å¿…ãš `await` ã™ã‚‹âœ…

### âŒ ãƒ¢ãƒƒã‚¯ã® Verify ãŒé€šã‚‰ãªã„ï¼ˆCancellationTokené•ã„ï¼‰

â†’ `It.IsAny<CancellationToken>()` ã§ã¾ãšé€šã™ã€å¿…è¦ãªã‚‰å³å¯†åŒ–ğŸ¯

### âŒ â€œã‚¤ãƒ™ãƒ³ãƒˆã®ä¸­èº«â€ã«å·¨å¤§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å…¥ã‚Œã¦ãƒ†ã‚¹ãƒˆãŒåœ°ç„

â†’ ãã®ã‚¤ãƒ™ãƒ³ãƒˆã€å¤ªã‚Šã™ãğŸ˜ğŸ’¦ï¼ˆç¬¬17ç« ã®å¾©ç¿’ï¼ï¼‰
å¿…è¦æœ€å°é™ã«çµã‚‹âœ‚ï¸âœ¨

---

## ã‚„ã£ã¦ã¿ã‚ˆã†ğŸ› ï¸ğŸ€ï¼ˆç·´ç¿’å•é¡Œï¼‰

### ç·´ç¿’1ğŸ“§

`OrderPaid` ã§ã€Œè³¼å…¥ã‚ã‚ŠãŒã¨ã†ãƒ¡ãƒ¼ãƒ«ã€ã§ã¯ãªãã€**é ˜åæ›¸ãƒ¡ãƒ¼ãƒ«**ã‚’é€ã‚‹ä»•æ§˜ã«ã—ã¦

* ä»¶åã« `OrderId` ã‚’å…¥ã‚Œã‚‹
* æœ¬æ–‡ã« `OccurredAtUtc` ã‚’å…¥ã‚Œã‚‹
  ã“ã®2ç‚¹ã‚’ãƒ†ã‚¹ãƒˆã§ç¢ºèªã—ã¦ã¿ã‚ˆã†âœ…

### ç·´ç¿’2ğŸ

`OrderPaid` ã®åˆ¥ãƒãƒ³ãƒ‰ãƒ©ã¨ã—ã¦ `GrantPointsHandler` ã‚’ä½œã£ã¦ã¿ã‚ˆã†ğŸ

* `IPointService.AddAsync(customerId, points)` ã‚’å‘¼ã¶ã ã‘ã«ã™ã‚‹
* ãƒ†ã‚¹ãƒˆã¯ã€Œ1å›å‘¼ã°ã‚ŒãŸã‹ã€ã ã‘ã§OKâœ…

### ç·´ç¿’3ğŸ§¯ï¼ˆç™ºå±•ï¼‰

ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãŒè½ã¡ãŸã¨ãã€

* **ä¾‹å¤–ã‚’æŠ•ã’ã‚‹æ–¹é‡**ğŸ’¥
* **ãƒ­ã‚°ã ã‘å‡ºã—ã¦é£²ã¿è¾¼ã‚€æ–¹é‡**ğŸ™‚
  ã©ã£ã¡ã«ã™ã‚‹ã‹æ±ºã‚ã¦ã€ãƒ†ã‚¹ãƒˆã‚‚ãã‚Œã«åˆã‚ã›ã¦ä½œã‚ã†âœ…

---

## AIæ‹¡å¼µã®ä½¿ã„ã©ã“ã‚ğŸ¤–âœ¨ï¼ˆå®‰å…¨ã«æ™‚çŸ­ï¼ï¼‰

* ã€ŒArrange-Act-Assert ã®å½¢ã§ã€xUnit ã®ãƒ†ã‚¹ãƒˆé››å½¢ã‚’ä½œã£ã¦ã€ğŸ§ª
* ã€Œã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ãƒ•ã‚§ã‚¤ã‚¯å®Ÿè£…ã‚’ã€æœ€å°ã®è¨˜éŒ²æ©Ÿèƒ½ã¤ãã§ä½œã£ã¦ã€ğŸ§¸
* ã€ŒVerify ãŒé€šã‚‰ãªã„åŸå› ã‚’ã€CancellationToken/å¼•æ•°/await è¦³ç‚¹ã§ãƒã‚§ãƒƒã‚¯ã—ã¦ã€ğŸ”

âš ï¸ ãŸã ã—ã€**ä¾‹å¤–ã‚’æŠ•ã’ã‚‹/é£²ã¿è¾¼ã‚€**ã¿ãŸã„ãªâ€œæ–¹é‡â€ã¯AIä»»ã›ã«ã›ãšã€å¿…ãšè‡ªåˆ†ã§æ±ºã‚ã‚‹ã®ãŒã‚³ãƒ„ã ã‚ˆğŸ¯ğŸ™‚

---

## ãƒã‚§ãƒƒã‚¯âœ…âœ¨

* [ ] ãƒãƒ³ãƒ‰ãƒ©å˜ä½“ãƒ†ã‚¹ãƒˆã§ã¯ã€å¤–éƒ¨I/Oã‚’æœ¬ç‰©ã§å‘¼ã‚“ã§ãªã„ğŸ™…â€â™€ï¸
* [ ] `IEmailSender` ã¿ãŸã„ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§å·®ã—æ›¿ãˆã§ãã¦ã‚‹ğŸ§©
* [ ] ãƒ¢ãƒƒã‚¯ or ãƒ•ã‚§ã‚¤ã‚¯ã§ã€Œå‘¼ã°ã‚ŒãŸã“ã¨ã€ã‚’æ¤œè¨¼ã§ããŸğŸ­ğŸ§¸
* [ ] å¤±æ•—æ™‚ã®æ–¹é‡ï¼ˆæŠ•ã’ã‚‹/é£²ã¿è¾¼ã‚€ï¼‰ãŒãƒ†ã‚¹ãƒˆã§å®ˆã‚Œã¦ã‚‹ğŸ§¯âœ…

---

[1]: https://devblogs.microsoft.com/dotnet/announcing-dotnet-10/?utm_source=chatgpt.com "Announcing .NET 10"
[2]: https://xunit.net/releases/?utm_source=chatgpt.com "Release Notes"
[3]: https://xunit.net/?utm_source=chatgpt.com "xUnit.net: Home"
[4]: https://www.nuget.org/packages/xunit.runner.visualstudio?utm_source=chatgpt.com "xunit.runner.visualstudio 3.1.5"
[5]: https://www.nuget.org/packages/moq/?utm_source=chatgpt.com "Moq 4.20.72"
[6]: https://learn.microsoft.com/ja-jp/dotnet/api/microsoft.extensions.logging.testing.fakelogger?view=net-9.0-pp&utm_source=chatgpt.com "FakeLogger Class (Microsoft.Extensions.Logging.Testing)"
[7]: https://www.nuget.org/packages/Microsoft.Extensions.Diagnostics.Testing/?utm_source=chatgpt.com "Microsoft.Extensions.Diagnostics.Testing 10.2.0"
