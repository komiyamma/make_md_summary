# ç¬¬2ç«  ã¾ãšã¯è¶…åŸºæœ¬ï¼šã‚³ãƒãƒ³ãƒ‰ã¨ã‚¤ãƒ™ãƒ³ãƒˆã®é•ã„ğŸ“£ğŸ¤”

## 2.1 ã¾ãšçµè«–ï¼š2ã¤ã¯ã€Œå½¹å‰²ã€ãŒçœŸé€†ã ã‚ˆğŸ§©âœ¨

* **Commandï¼ˆã‚³ãƒãƒ³ãƒ‰ï¼‰ï¼å‘½ä»¤ãƒ»ä¾é ¼ğŸ“£**
  ã€Œã“ã‚Œã‚’ã‚„ã£ã¦ï¼ã€ï¼ˆã“ã‚Œã‹ã‚‰èµ·ãã¦ã»ã—ã„ã“ã¨ï¼‰
* **Eventï¼ˆã‚¤ãƒ™ãƒ³ãƒˆï¼‰ï¼èµ·ããŸäº‹å®ŸğŸ””**
  ã€Œã“ã‚ŒãŒèµ·ããŸï¼ã€ï¼ˆã‚‚ã†èµ·ããŸã“ã¨ãƒ»è¨˜éŒ²ã—ãŸã„ã“ã¨ï¼‰

ç‰¹ã«ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã§ã¯ã€**ã‚¤ãƒ™ãƒ³ãƒˆã¯â€œéå»ã«èµ·ããŸäº‹å®Ÿâ€**ã¨ã—ã¦æ‰±ã†ã®ãŒå¤§äº‹ã ã‚ˆğŸ•’âœ¨ ([Microsoft Learn][1])

---

## 2.2 ãŸã¨ãˆè©±ã§ã‚¹ãƒƒã‚­ãƒªç†è§£ğŸ”ğŸ§‘â€ğŸ³ğŸ“¦

### ğŸ½ï¸ ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ç·¨

* **Command**ï¼šã€Œãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ä½œã£ã¦ãã ã•ã„ï¼ã€ğŸ“£
  â†’ åº—å“¡ã•ã‚“ã«â€œä¾é ¼â€ã—ã¦ã‚‹ï¼ˆæ–­ã‚‰ã‚Œã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚‹ï¼šææ–™åˆ‡ã‚Œã¨ã‹ğŸ¥²ï¼‰
* **Event**ï¼šã€Œãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãŒä½œã‚‰ã‚ŒãŸã€ğŸ””
  â†’ ã‚‚ã†èµ·ããŸâ€œäº‹å®Ÿâ€ï¼ˆå–ã‚Šæ¶ˆã›ãªã„ãƒ»è¨€ã„æ›ãˆã‚‹ã¨å±¥æ­´ï¼‰ğŸ§¾

---

## 2.3 è¦‹åˆ†ã‘æ–¹ã¯ã“ã®3ç‚¹ã§OKâœ…âœ¨

### âœ…â‘  æ–‡ã®å½¢ï¼ˆå‘½ä»¤å½¢ vs éå»å½¢ï¼‰

* Commandï¼š**ã€Œã€œã—ã¦ï¼ã€**ï¼ˆãŠé¡˜ã„ãƒ»å‘½ä»¤ï¼‰ğŸ“£
* Eventï¼š**ã€Œã€œã—ãŸã€**ï¼ˆäº‹å®Ÿï¼‰ğŸ””
  ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã¯ã€Œèµ·ããŸã“ã¨ã€ãªã®ã§ **éå»å½¢ãŒåŸºæœ¬**ã ã‚ˆğŸ•’ ([Microsoft Learn][1])

### âœ…â‘¡ æˆåŠŸ/å¤±æ•—ãŒã‚ã‚‹ã®ã¯ã©ã£ã¡ï¼Ÿ

* Commandï¼š**å¤±æ•—ã™ã‚‹ã“ã¨ãŒã‚ã‚‹**ï¼ˆæ”¯æ‰•ã„NGã€åœ¨åº«ãªã—ã€æ¨©é™ãªã—â€¦âš ï¸ï¼‰
* Eventï¼š**å¤±æ•—ã—ãªã„**ï¼ˆèµ·ããŸäº‹å®Ÿã‚’è¨€ã£ã¦ã‚‹ã ã‘ã ã‹ã‚‰ï¼‰

### âœ…â‘¢ èª°ãŒä¸»èªï¼Ÿ

* Commandï¼š**ã€Œã‚„ã£ã¦ã»ã—ã„ã€**ï¼ˆèª°ã‹ã«ä»•äº‹ã‚’é ¼ã‚€ï¼‰ğŸ§‘â€âœˆï¸
* Eventï¼š**ã€Œèµ·ããŸã€**ï¼ˆè¦³æ¸¬ãƒ»è¨˜éŒ²ï¼‰ğŸ”

---

## 2.4 ãƒŸãƒ‹ECã§è¦‹ã‚‹ï¼šæ³¨æ–‡â†’æ”¯æ‰•ã„â†’ç™ºé€ğŸ›’ğŸ’³ğŸ“¦

### ğŸ“£ Commandã®ä¾‹ï¼ˆä¾é ¼ï¼‰

* ã€Œæ”¯æ‰•ã„ã‚’å®Ÿè¡Œã—ã¦ï¼ã€ï¼ˆPayOrderï¼‰ğŸ’³
* ã€Œç™ºé€ã—ã¦ï¼ã€ï¼ˆShipOrderï¼‰ğŸ“¦
* ã€Œæ³¨æ–‡ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¦ï¼ã€ï¼ˆCancelOrderï¼‰ğŸ›‘

### ğŸ”” Eventã®ä¾‹ï¼ˆäº‹å®Ÿï¼‰

* ã€Œæ”¯æ‰•ã„ãŒå®Œäº†ã—ãŸã€ï¼ˆOrderPaidï¼‰âœ…
* ã€Œç™ºé€ã•ã‚ŒãŸã€ï¼ˆOrderShippedï¼‰ğŸšš
* ã€Œæ³¨æ–‡ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸã€ï¼ˆOrderCanceledï¼‰ğŸ§¾

ã‚¤ãƒ™ãƒ³ãƒˆåã¯ **â€œéå»å½¢ + ãƒ‰ãƒ¡ã‚¤ãƒ³ã®è¨€è‘‰â€**ãŒèª­ã¿ã‚„ã™ã„ã‚ˆâœ¨ ([Microsoft Learn][1])

---

## 2.5 ã‚ˆãã‚ã‚‹æ··åŒãƒ‘ã‚¿ãƒ¼ãƒ³âš ï¸ğŸ˜µâ€ğŸ’«ï¼ˆã“ã“å¤§äº‹ï¼ï¼‰

### âŒã€Œã‚¤ãƒ™ãƒ³ãƒˆãªã®ã«å‘½ä»¤ã—ã¦ã‚‹ã€ä¾‹

* `SendPaymentEmail` ğŸ”¥ï¼ˆãƒ¡ãƒ¼ãƒ«é€ã£ã¦ï¼å‘½ä»¤ã˜ã‚ƒã‚“ï¼ğŸ“£ï¼‰
* `SaveOrderToDb` ğŸ”¥ï¼ˆDBã«ä¿å­˜ã—ã¦ï¼æŠ€è¡“è©³ç´°ã ã—å‘½ä»¤ã£ã½ã„ï¼‰

### âœ…ã€Œäº‹å®Ÿã€ã«ç›´ã™ã¨ã“ã†ãªã‚‹

* `PaymentEmailSent`ï¼ˆæ”¯æ‰•ã„ãƒ¡ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚ŒãŸï¼‰ğŸ“§âœ…
  â€»ãŸã ã—â€œé€ã‚‹â€ã®ã¯å‰¯ä½œç”¨ãªã®ã§ã€æœ€åˆã¯ **ã€Œæ”¯æ‰•ã„ãŒå®Œäº†ã—ãŸã€**ã¿ãŸã„ãªâ€œä¸­å¿ƒã®äº‹å®Ÿâ€ã‚’å„ªå…ˆã™ã‚‹ã¨è¿·ã„ã«ãã„ã‚ˆğŸ™‚
* `OrderPlaced`ï¼ˆæ³¨æ–‡ãŒç¢ºå®šã—ãŸï¼‰ğŸ›’âœ…

---

## 2.6 åˆ†é¡ã‚²ãƒ¼ãƒ ï¼šå‘½ä»¤ï¼Ÿãã‚Œã¨ã‚‚äº‹å®Ÿï¼ŸğŸ®âœ¨ï¼ˆ10å•ï¼‰

æ¬¡ã®10å€‹ã‚’ **Command / Event** ã«åˆ†é¡ã—ã¦ã¿ã‚ˆã†âœï¸ğŸ™‚

1. ã€Œæ”¯æ‰•ã„ã‚’å®Ÿè¡Œã—ã¦ï¼ã€ğŸ’³
2. ã€Œæ”¯æ‰•ã„ãŒå®Œäº†ã—ãŸã€âœ…
3. ã€Œæ³¨æ–‡ã‚’ç¢ºå®šã—ã¦ï¼ã€ğŸ›’
4. ã€Œæ³¨æ–‡ãŒç¢ºå®šã—ãŸã€ğŸ§¾
5. ã€Œåœ¨åº«ã‚’å¼•ãå½“ã¦ã¦ï¼ã€ğŸ“¦
6. ã€Œåœ¨åº«ãŒå¼•ãå½“ã¦ã‚‰ã‚ŒãŸã€ğŸ“¦âœ…
7. ã€Œé…é€ãƒ©ãƒ™ãƒ«ã‚’ä½œã£ã¦ï¼ã€ğŸ·ï¸
8. ã€Œé…é€ãƒ©ãƒ™ãƒ«ãŒä½œæˆã•ã‚ŒãŸã€ğŸ·ï¸âœ…
9. ã€Œæ³¨æ–‡ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¦ï¼ã€ğŸ›‘
10. ã€Œæ³¨æ–‡ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸã€ğŸ§¾ğŸ›‘

### âœ…ç­”ãˆåˆã‚ã›ï¼ˆã‚µã‚¯ãƒƒã¨ï¼‰

* Commandï¼š**1, 3, 5, 7, 9** ğŸ“£
* Eventï¼š**2, 4, 6, 8, 10** ğŸ””

**ã‚³ãƒ„**ï¼šEventã¯ã€Œã€œã•ã‚ŒãŸã€ã€Œã€œã—ãŸã€ã«ãªã£ã¦ã‚‹ã“ã¨ãŒå¤šã„ã‚ˆğŸ•’âœ¨ ([Microsoft Learn][1])

---

## 2.7 C#ã§è¶…ãƒŸãƒ‹å®Ÿè£…ï¼šCommandã¨Eventã‚’â€œå‹â€ã§åˆ†ã‘ã‚ˆã†ğŸ§·âœ¨

ãƒã‚¤ãƒ³ãƒˆã¯ã“ã‚ŒğŸ‘‡

* Commandï¼š**ã€ŒãŠé¡˜ã„ã€**ãªã®ã§ã€å…¥åŠ›ï¼ˆä½•ã‚’ã—ãŸã„ã‹ï¼‰ã‚’æŒã¤ğŸ“£
* Eventï¼š**ã€Œäº‹å®Ÿã€**ãªã®ã§ã€èµ·ããŸã“ã¨ï¼‹æœ€ä½é™ã®æƒ…å ±ã‚’æŒã¤ğŸ””
* Eventã¯åŸºæœ¬ **å¤‰æ›´ã—ãªã„ï¼ˆã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ï¼‰**ãŒç›¸æ€§ã„ã„ã‚ˆğŸ”’ ([download.microsoft.com][2])

```csharp
using System;

public interface ICommand { }
public interface IEvent { }

public sealed record PayOrderCommand(Guid OrderId, decimal Amount) : ICommand;   // å‘½ä»¤ğŸ“£
public sealed record OrderPaidEvent(Guid OrderId, decimal Amount, DateTimeOffset OccurredAt) : IEvent; // äº‹å®ŸğŸ””

public sealed class Order
{
    public Guid Id { get; }
    public bool IsPaid { get; private set; }

    public Order(Guid id) => Id = id;

    // âœ… Commandã‚’å—ã‘ã¦ã€ãƒ«ãƒ¼ãƒ«ã‚’æº€ãŸã›ãŸã‚‰çŠ¶æ…‹ãŒå¤‰ã‚ã‚Šã€EventãŒç”Ÿã¾ã‚Œã‚‹âœ¨
    public OrderPaidEvent Pay(decimal amount)
    {
        if (IsPaid) throw new InvalidOperationException("ã™ã§ã«æ”¯æ‰•ã„æ¸ˆã¿ã ã‚ˆğŸ˜µâ€ğŸ’«");
        if (amount <= 0) throw new ArgumentException("é‡‘é¡ãŒä¸æ­£ã ã‚ˆâš ï¸");

        IsPaid = true;

        return new OrderPaidEvent(
            OrderId: Id,
            Amount: amount,
            OccurredAt: DateTimeOffset.UtcNow
        );
    }
}
```

### ğŸ‘€ ã“ã“ã§è¦‹ãŸã„æµã‚Œï¼ˆè¶…é‡è¦ï¼‰ğŸ§ âœ¨

1. å¤–ã‹ã‚‰ **Command** ãŒæ¥ã‚‹ğŸ“£ï¼ˆä¾‹ï¼šPayOrderCommandï¼‰
2. ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆOrderï¼‰ãŒãƒ«ãƒ¼ãƒ«ã‚’å®ˆã£ã¦å‡¦ç†ã™ã‚‹ğŸ§©
3. çŠ¶æ…‹ãŒå¤‰ã‚ã£ãŸã‚‰ **Event** ãŒç”Ÿã¾ã‚Œã‚‹ğŸ””ï¼ˆä¾‹ï¼šOrderPaidEventï¼‰

---

## 2.8 å‘½åãƒŸãƒ‹ç·´ç¿’ï¼šè‰¯ã„åå‰ã«è¨€ã„æ›ãˆã‚ˆã†âœï¸âœ¨

æ¬¡ã‚’ã€ŒCommandã£ã½ã„ï¼Ÿ Eventã£ã½ã„ï¼Ÿã€ã§ç›´ã—ã¦ã¿ã‚ˆã†ğŸ™‚

* `CompletePayment`ï¼ˆã“ã‚Œã€ã©ã£ã¡ã§ã‚‚èª­ã‚ã¡ã‚ƒã†ğŸ˜µâ€ğŸ’«ï¼‰

  * âœ… Commandå¯„ã‚Šã«ã™ã‚‹ãªã‚‰ï¼š`PayOrder` / `CompletePaymentCommand` ğŸ“£
  * âœ… Eventå¯„ã‚Šã«ã™ã‚‹ãªã‚‰ï¼š`PaymentCompleted` / `OrderPaid` ğŸ””

---

## 2.9 AIï¼ˆCopilotç­‰ï¼‰ã‚’ä½¿ã†ã¨ãã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹ğŸ¤–âœ¨

### ğŸ§  å‘½åæ¡ˆã‚’å‡ºã—ã¦ã‚‚ã‚‰ã†ï¼ˆä¾¿åˆ©ï¼ï¼‰

* ã€Œâ€œæ”¯æ‰•ã„å®Œäº†â€ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆåã‚’ã€éå»å½¢ã§10å€‹ææ¡ˆã—ã¦ã€‚ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã£ã½ãçŸ­ãã€‚ã€

### ğŸ” æ··åŒãƒã‚§ãƒƒã‚¯ã‚’ã•ã›ã‚‹ï¼ˆå®‰å…¨ï¼ï¼‰

* ã€Œã“ã®åå‰ã¯Command/Eventã©ã£ã¡ï¼Ÿç†ç”±ã‚‚ã€‚`ShipOrder`, `OrderShipped`, `CreateShipmentLabel`, `ShipmentLabelCreated`ã€

â€»æœ€å¾Œã¯å¿…ãšè‡ªåˆ†ã§ã‚‚ç¢ºèªã­ğŸ™‚ï¼ˆâ€œå‘½ä»¤ã«ãªã£ã¦ãªã„ï¼Ÿâ€ â€œäº‹å®Ÿã«ãªã£ã¦ã‚‹ï¼Ÿâ€ï¼‰

---

## 2.10 ãƒã‚§ãƒƒã‚¯âœ…ï¼ˆã“ã®ç« ã®ã‚´ãƒ¼ãƒ«ï¼‰

* Commandã¯ **ã€Œã‚„ã£ã¦ï¼ã€** ğŸ“£
* Eventã¯ **ã€Œèµ·ããŸï¼ã€** ğŸ””ï¼ˆéå»å½¢ãŒåŸºæœ¬ï¼‰ğŸ•’ ([Microsoft Learn][1])
* ã€Œã‚¤ãƒ™ãƒ³ãƒˆã§å‘½ä»¤ã—ãªã„ã€ğŸ™…â€â™€ï¸
* **Command â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³å‡¦ç† â†’ Event** ã®æµã‚ŒãŒè¦‹ãˆãŸã‚‰å‹ã¡ğŸâœ¨

---

## 2.11 ãŠã¾ã‘ï¼šæœ€æ–°C#ç’°å¢ƒã®ã²ã¨ã“ã¨ãƒ¡ãƒ¢ğŸª„ğŸ§©

* **C# 14 ãŒæœ€æ–°ãƒªãƒªãƒ¼ã‚¹**ã§ã€**.NET 10 ä¸Šã§ã‚µãƒãƒ¼ãƒˆ**ã•ã‚Œã¦ã„ã‚‹ã‚ˆğŸ§ âœ¨ ([Microsoft Learn][3])
* **.NET 10 SDK**ã¯å…¬å¼ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã‹ã‚‰å…¥ã‚Œã‚‰ã‚Œã‚‹ã‚ˆğŸ§© ([dotnet.microsoft.com][4])

[1]: https://learn.microsoft.com/en-us/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/domain-events-design-implementation?utm_source=chatgpt.com "Domain events: Design and implementation - .NET"
[2]: https://download.microsoft.com/download/e/a/8/ea8c6e1f-01d8-43ba-992b-35cfcaa4fae3/cqrs_journey_guide.pdf?utm_source=chatgpt.com "Exploring CQRS and Event Sourcing"
[3]: https://learn.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-14?utm_source=chatgpt.com "What's new in C# 14"
[4]: https://dotnet.microsoft.com/en-US/download/dotnet/10.0?utm_source=chatgpt.com "Download .NET 10.0 (Linux, macOS, and Windows) | .NET"
